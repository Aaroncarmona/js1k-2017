g=(x,y,z)=>(x+360)%360,k=(x,y,z)=>x<y&&y<z;s=(x,y,z)=>k(0,y/6%51,1)?7:y%6&&(x+(y/6&1)*6)%12&&(s(x+1,y)?8:6);M=(x,y,z)=>x/60|0,u=(x,y,z)=>(z=M(y)*6+M(x))*28%64<39-z/4;for(p=[x=360];h=t=m=n=x--;){for(p[x]=[o=y=1230];y--;)p[x][y]=y<42&&k(126,x,P=150)?x&3:u(x,y)&&(k(24,y%60,30)&&k(0,x%60,36)?9:k(30,y%60,54)&&k(6,x%60,30))||s(x,y);D=-12}a.style='width:480px;height:640px;image-rendering:pixelated';onkeydown=onkeyup=(x,y,z)=>c[39-x.which]=x.type[5];setInterval(x=(x,y,z)=>{m++;I=!c[2]-!c[0];i=g(i+I*4);h+=n=-Math.min(c[1]&&P&&P--?3:10,1-n);D+=(y=h-D)>110?y-110:y<5&&y-5;t=h>1228?h=c[n=0]=o:0,(M(h)-19||m%60<30)&&u(g(98+i),h)&&k(n,h%60-30,1)&&k(0,(i+38)%60,52)&&(h+=30-h%60,n=14);h>0||(n=14,h=-2);(x=(x,y,z)=>{for(w=c.createImageData(x,160);x--;)for(e=g(~I?x-53:69-x),y=160;y--;)z=D+y,l=k(0,f=z-h+!t*Math.sin(x/2)*(14-Math.hypot(n))/8|0,24)&&k(52,x,68)&&!(f<0||47-e<f*2||f/3<6-e&&f>e*5-4||e*2>37-f&&e+4>f)?e+7-f?e*2>30-f&&e+4>f?9:2:4:z<0?2+z/6:z>o?t?(x-60)/(100-y)*5+m/4&1&&4:1:Math.sin(r=Math.acos(x/60%2-1))*4-6+p[g((1-r/Math.PI)*180+i|0)][M(z)-19||m%60<30?z:z%12+60],d=Math.min(1,-Math.min(0,Math.hypot(60-x,12-z+h)/12-2))*P*l/10,w.data[((159-y)*120+x)*4]=30+l*8+d*3|0,w.data[((159-y)*120+x)*4+1]=30+l*8+d*2|0,w.data[((159-y)*120+x)*4+2]=40+l*16+d|0,w.data[((159-y)*120+x)*4+3]=255;c.putImageData(w,0,0)})(120)},i=42)